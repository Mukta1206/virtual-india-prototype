<html>
{% load static %}

<head>
    <title>{% block title %}{% endblock %}</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/mukta.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body style="background-color:white;font-family: Arial, Helvetica, sans-serif;box-sizing: border-box;">
    <center>
        <br>

        <div class="topnav-centered" id="myTopnav" style="display:flex; place-content: center; ">
            <a href="{% url 'india' %}" style="float: left;"><i class="fa fa-home"></i> Home</a>
            <a href="{% url 'user_abt' %}" style="float: right;">About Us</a>
            {% if user.is_authenticated %}
            <a href="{% url 'home' %}">Explore</a>
            <div style="flex-grow: 1; position: relative; ">

                <!-- ðŸ” Search bar visible only on home page -->
                {% if request.resolver_match.url_name == 'home' %}
                <form method="get" action="{% url 'search_results' %}"
                    style="text-align:center; margin-top: 5px; display:flex;  border-radius:8px;  border:2px solid #ccc; width:auto; align-items: center; justify-items: center; width:50%">
                    <input id="search-input" type="search" name="q" autocomplete="off"
                        placeholder="Search for food, places, culture..."
                        style="padding:10px; width:45%; border:0; font-size:15px; outline:none; flex:1">
                    <button type="submit" style="width: auto; border-radius:8px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-search" viewBox="0 0 16 16">
                            <path
                                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                        </svg>

                    </button>

                </form>
                {% endif %}

            </div>
            {% endif %}
            {% if user.is_authenticated %}
            <a href="{% url 'user_logout' %}" style="float: right;">Logout</a>
            <a href="{% url 'user_cp' %}" style="float: right;">Forgot Password</a>

            {% else %}
            <a href="{% url 'user_signup' %}">Sign Up</a>
            <a href="{% url 'user_login' %}">Login</a>
            <a href="javascript:void(0);" class="icon" onclick="myFunction()"></a>
            {% endif %}
        </div>

        <div style="position: absolute; top:80px; width:100%; ">

            <ul id="search-suggest"
                style="list-style: none; background:white;display:none">
            </ul>
        </div>


        <div style="z-index: -1;">

            {% block content %}{% endblock %}
        </div>


        <button id="chat-toggle" style="position:fixed;bottom:25px;right:25px;background:#007bff;color:white;
         border:none;border-radius:50%;width:60px;height:60px;
         font-size:26px;box-shadow:0 4px 10px rgba(0,0,0,0.2);cursor:pointer;
         z-index:1000;">
            ðŸ’¬
        </button>


        <div id="chat-popup" style="display:none;position:fixed;bottom:100px;right:25px;width:550px;
         background:white;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);
         z-index:1000;overflow:hidden;">
            <div style="background:#007bff;color:white;padding:10px;text-align:center;font-weight:bold;">
                ðŸ§­ Tourism Chatbot
            </div>

            <button id="chat-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x"
                    viewBox="0 0 16 16">
                    <path
                        d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                </svg>
            </button>

            <div id="chat-box" style="height:300px;overflow-y:auto;padding:10px;background:#fafafa;font-size:14px;">
                <div style="color:#555;">ðŸ‘‹ Hi there! Ask me about any place or attraction in India!</div>
            </div>

            <div style="display:flex;gap:5px;padding:10px;background:#fff;">
                <input id="user-input" type="text" placeholder="Type your question..."
                    style="flex:1;padding:8px;border:1px solid #ccc;border-radius:5px;">
                <button id="send-btn"
                    style="padding:8px 12px;background:#007bff;color:white;border:none;border-radius:5px;">Send</button>
            </div>
        </div>
    </center>
</body>



<script>
    const inputsearch = document.getElementById('search-input');
    const suggestBox = document.getElementById('search-suggest');

    inputsearch.addEventListener('input', async function () {
        const query = this.value.trim();

        // Hide suggestions if input is empty
        if (query.length < 2) {
            suggestBox.style.display = 'none';
            suggestBox.innerHTML = '';
            return;
        }

        try {
            const res = await fetch(`http://127.0.0.1:8000/suggest/?q=${encodeURIComponent(query)}`);
            const json = await res.json()
            const results = json.results

            // Clear previous suggestions
            suggestBox.innerHTML = '';

            
            if (results.length > 0) {
                results.forEach(r => {
                    const li = document.createElement('li');
                    li.style.listStyle = 'none';
                    li.style.padding = '10px';
                    li.style.cursor = 'pointer';
                    li.style.borderBottom = '1px solid #eee';

                    li.innerHTML = `
                    <a href="/${r.file_path.replace('.html','')}#${r.anchor}" style="width:260px; border:1px solid #ddd; border-radius:10px; overflow:hidden;
                                box-shadow:0 2px 6px rgba(0,0,0,0.1); background:white;">
                      <div style="padding:15px; text-align:center;">

                        <!-- ðŸ™ï¸ Place or Attraction -->
                        <h4 style="margin-bottom:10px; font-size:18px; font-weight:bold; color:#000;">
                          ${r.item}
                        </h4>

                        <!-- ðŸ“ City -->
                        <p style="margin:0 0 10px 0; font-size:14px; color:#666;">
                          Found in <strong>${r.city}</strong>
                        </p>

                        <!-- ðŸ’¯ Match Score -->
                        <p style="margin:0 0 15px 0; font-size:12px; color:#999;">
                          Relevance: ${r.score}
                        </p>
                      </div>
                    </a>
                `;
                    li.onclick = () => {
                        input.value = r.item;
                        console.log('hi')
                        suggestBox.style.display = 'none';
                    };

                    suggestBox.appendChild(li);
                });
                suggestBox.style.setProperty('display', 'block', 'important')
            } else {
                suggestBox.style.display = 'none';
            }

        } catch (error) {
            console.error('Error fetching suggestions:', error);
            suggestBox.style.display = 'none';
        }
    });

</script>

<script>
    const chatToggle = document.getElementById("chat-toggle");
    const chatPopup = document.getElementById("chat-popup");
    const chatBox = document.getElementById("chat-box");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    chatToggle.onclick = () => {
        chatPopup.style.display = chatPopup.style.display === "none" ? "block" : "none";
    };

    sendBtn.onclick = sendMessage;
    input.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

    async function sendMessage() {
        const userMessage = input.value.trim();
        if (!userMessage) return;

        chatBox.innerHTML += `<div style="text-align: left; width:100%;"><b>You:</b> ${userMessage}</div>`;
        input.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;

        const res = await fetch("http://127.0.0.1:8000/chatgpt/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMessage })
        });
        const data = await res.json();

        if (data.reply)
            chatBox.innerHTML += `<div style="color:green;"><b>Bot:</b> ${data.reply}</div>`;
        else
            chatBox.innerHTML += `<div style="color:red;"><b>Error:</b> ${data.error}</div>`;

        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>




</html>